---
title: ASP.NET 資料存取、新增、刪除
date: 2023-02-10 15:37:34
tags:
categories:
  - ASP.NET
---

一直想說有什麼辦法
可以減少cs的程式行數
行數會多都是因為寫資料存取、新增、刪除
<!--more-->
無意見看到這篇文章
測試後沒問題
記錄下來

### 建立SQLDataAccess.cs 類別檔
```
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;

namespace DataObject
{
    public class SQLDataAccess
    {
        public DataTable readCmd(string SqlCmd, Dictionary<string, string> param)
        {
            string connStr = ConfigurationManager.ConnectionStrings["DemoConnectionString"].ConnectionString;
            DataTable dt = new DataTable();


            using (SqlConnection conn = new SqlConnection(connStr))
            {
                SqlCommand cmd = new SqlCommand(SqlCmd, conn);


                foreach (KeyValuePair<string, string> pair in param)
                {
                    cmd.Parameters.AddWithValue("@" + pair.Key, pair.Value);
                }

                conn.Open();


                SqlDataReader reader = cmd.ExecuteReader();
                dt.Load(reader);
            }

            return dt;
        }


        public void executeCmd(string CmdSQL, Dictionary<string, string> param)
        {
            string conn = ConfigurationManager.ConnectionStrings["SQLConnectionString"].ConnectionString;

            using (SqlConnection connection = new SqlConnection(conn))
            {
                SqlCommand cmd = new SqlCommand(CmdSQL, connection);

                foreach (KeyValuePair<string, string> pair in param)
                {
                    cmd.Parameters.AddWithValue("@" + pair.Key, pair.Value);
                }

                connection.Open();
                cmd.ExecuteNonQuery();
                connection.Close();
            }
        }
    }
}
```

### C#引用
```
using DataObject;

public SQLDataAccess sqlDA = new SQLDataAccess();

protected void GridView1_RowUpdating(object sender, GridViewUpdateEventArgs e)
    {
        try
        {
            string UpdateCmd = "UPDATE [MCS_File] SET [MF004] = @MF004,MF005 = @MF005 WHERE [MF003] = @MF003";

            Dictionary<string, string> paras = new Dictionary<string, string>();
            string MF003, MF004, MF005;
            MF003 = GridView1.DataKeys[e.RowIndex].Value.ToString(); //圖片名稱
            MF004 = ((TextBox)GridView1.Rows[e.RowIndex].Cells[0].FindControl("TextBox3")).Text; //說明
            MF005 = ((TextBox)GridView1.Rows[e.RowIndex].Cells[0].FindControl("TextBox2")).Text; //日期
            paras.Add("MF004", MF004);
            paras.Add("MF005", MF005);
            paras.Add("MF003", MF003);

            this.sqlDA.executeCmd(UpdateCmd, paras);
        }
        catch (Exception ex)
        {
             
        }
    }

    protected void GridView1_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        string MF003 = ((Label)GridView1.Rows[e.RowIndex].Cells[0].FindControl("Label1")).Text;
        try
        {
            string DeleteCmd = "DELETE FROM MCS_File WHERE MF003 = @MF003";

            Dictionary<string, string> paras = new Dictionary<string, string>();

            paras.Add("MF003", MF003);

            this.sqlDA.executeCmd(DeleteCmd, paras);
        }
        catch (Exception ex)
        {

        }        
    }
```
[參考](https://dotblogs.com.tw/dplayerd/2017/12/11/002459)