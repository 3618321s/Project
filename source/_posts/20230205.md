---
title: GridView 額外使用方式
date: 2023-02-09 14:02:13
tags:
  - GridView
categories:
  - ASP.NET
---

上一篇 GridView 如何新增、編輯、刪除、換頁

這篇紀錄一些額外使用方式

<!--more-->

### 開窗顯示圖片

```
        <asp:TemplateField HeaderText="圖片名稱">
            <ItemTemplate>
                <a href="<%# "/img/" + Eval("圖片名稱") %>" target="_blank">點擊查看</a>
            </ItemTemplate>
        </asp:TemplateField>
```
### 按鈕開窗

#### 使用TemplateField Button
##### aspx
```
<asp:TemplateField HeaderText="欄位標題" SortExpression="資料欄位名稱">
    <ItemTemplate>
        <asp:Button ID="Button1" runat="server" CausesValidation="false" CommandName="Select" Text='<%# Bind("資料欄位名稱") %>' OnClick="Button1_Click" class="btn btn-link" />
    </ItemTemplate>
</asp:TemplateField>
```
##### C#
```
protected void Button1_Click(object sender, EventArgs e)
    {
        string s_url;
        int row = ((GridViewRow)((Button)sender).NamingContainer).RowIndex;
        Button btn = (Button)GridView1.Rows[row].FindControl("Button1");
        s_url = "./Step1.aspx?MA001=" + GridView1.Rows[row].Cells[0].Text;
        Response.Redirect(s_url);        
        Response.AddHeader("Refresh", "0"); //刷新頁面
    }
```
#### 使用 HyperLinkField
```
<asp:HyperLinkField HeaderText="查看圖片" DataNavigateUrlFields="編號" DataNavigateUrlFormatString="img_Details.aspx?MF002={0}" Target="_blank" Text="查看" />
```
#### 使用 ButtonField
##### aspx 需加入事件
```
<asp:ButtonField CommandName="Select" HeaderText="查看" Text="Select"/>
```
![Image](https://github.com/3618321s/blog/raw/gh-pages/images/Project/GridView按鈕事件.jpg)

##### C#
```
protected void gv_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        string s_url, MC002, Edit;
        MC002 = Request.QueryString["MC002"];
        Edit = Request.QueryString["Edit"];
        int rowIndex = int.Parse(e.CommandArgument.ToString());//RowIndex
        if (e.CommandName == "Select")
        {
            s_url = "./Step1.aspx?MA001=" + GridView1.Rows[row].Cells[0].Text;
            Response.Redirect(s_url);        
            Response.AddHeader("Refresh", "0"); //刷新頁面
        }
    }
```
### 合併欄位資料

#### aspx 需加入事件
![Image](https://github.com/3618321s/blog/raw/gh-pages/images/Project/GridView合併欄位事件.jpg)

#### C#
列出合併的欄位(須連續)，以下案例為合併前面兩欄
```
protected void gv_PreRender(object sender, EventArgs e)
    {
        int a = 1;
        foreach (GridViewRow wkitem in GridView1.Rows)
        {
            if (wkitem.RowIndex == 0)
            {
                wkitem.Cells[1].RowSpan = 1;
                wkitem.Cells[0].RowSpan = 1;
            }
            else if (wkitem.Cells[0].Text.Trim() == GridView1.Rows[wkitem.RowIndex - a].Cells[0].Text.Trim())
            {                
                GridView1.Rows[wkitem.RowIndex - a].Cells[1].RowSpan += 1;
                GridView1.Rows[wkitem.RowIndex - a].Cells[0].RowSpan += 1;
                a = a + 1;                
                wkitem.Cells[1].Visible = false;
                wkitem.Cells[0].Visible = false;
            }
            else
            {
                GridView1.Rows[wkitem.RowIndex].Cells[1].RowSpan = 1;
                GridView1.Rows[wkitem.RowIndex].Cells[0].RowSpan = 1;
                a = 1;
            }
        }
    }   
```
#### 圖片樣式
![Image](https://github.com/3618321s/blog/raw/gh-pages/images/Project/GridView合併事件.jpg)